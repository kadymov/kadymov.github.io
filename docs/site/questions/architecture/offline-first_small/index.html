<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Offline-First –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (small) - My Docs</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Offline-First \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 (small)";
        var mkdocs_page_input_path = "questions/architecture/offline-first_small.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> My Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">üìö –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é: JavaScript, React –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Questions</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Architecture</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../ddd/">Domain-Driven Design (DDD) –≤–æ Frontend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ddd_small/">Domain-Driven Design (DDD) –≤–æ Frontend (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../microfrontends/">–ú–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã (Microfrontends)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../microfrontends_small/">Microfrontends - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../offline-first/">Offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Offline-First –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (small)</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#offline-first">–ü—Ä–∏–Ω—Ü–∏–ø—ã Offline-First</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#indexeddb-offline-storage">IndexedDB –¥–ª—è Offline Storage</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#offline-first-data-service">Offline-First Data Service</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_1">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_2">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#react-hooks-offline-first">React Hooks –¥–ª—è Offline-First</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#service-worker-offline-first">Service Worker –¥–ª—è Offline-First</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_3">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sync-status-component">Sync Status Component</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#offline-first_1">–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã Offline-First</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#data-consistency-models">Data Consistency Models</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#storage-limits">Storage Limits –∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#best-practices-senior-level">Best Practices Senior-level</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#senior">–ß–∞—Å—Ç—ã–µ Senior –≤–æ–ø—Ä–æ—Å—ã</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../resilient-frontend/">–£—Å—Ç–æ–π—á–∏–≤–∞—è frontend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../resilient-frontend_small/">–£—Å—Ç–æ–π—á–∏–≤–∞—è Frontend –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../state-management/">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../state-management_small/">State Management Architecture - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../websockets-realtime/">WebSockets –∏ real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../websockets-realtime_small/">WebSockets –∏ Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Javascript</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/async-programming/">Promises, Async/Await –∏ Generators</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/async-programming_small/">Async Programming - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/currying/">Currying –≤ JavaScript</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/currying_small/">Currying - –®–ø–∞—Ä–≥–∞–ª–∫–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/event-loop/">Event Loop, Microtasks –∏ Macrotasks</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/event-loop_small/">Event Loop - –®–ø–∞—Ä–≥–∞–ª–∫–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/execution-model/">–ú–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è JavaScript</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/execution-model_small/">JavaScript Execution Model - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/garbage-collection/">Garbage Collection –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/garbage-collection_small/">Garbage Collection - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/scope-hoisting/">Let, Const, Var: Scope –∏ Hoisting</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/scope-hoisting_small/">Let, Const, Var - –®–ø–∞—Ä–≥–∞–ª–∫–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/typing-comparison/">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ JS –∏ Java</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/typing-comparison_small/">JS vs Java Typing + TypeScript - Senior Cheat Sheet (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Performance</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../performance/optimization/">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ frontend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../performance/optimization_small/">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Frontend (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >React</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../react/concurrent-rendering/">–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ React 18</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/concurrent-rendering_small/">React 18 Concurrent Rendering - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/context-api/">Context API vs Redux</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/context-api_small/">Context API vs Redux - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/hoc/">Higher-Order Components (HOC)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/hoc_small/">Higher-Order Components - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/reconciliation/">Reconciliation –∏ Virtual DOM</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/reconciliation_small/">Reconciliation &amp; Virtual DOM - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/rerender-optimization/">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤ –≤ React</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/rerender-optimization_small/">React Rerender Optimization - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/ssr-rsc/">SSR/SSG –∏ React Server Components</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/ssr-rsc_small/">SSR/SSG &amp; React Server Components - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/use-effect/">useEffect –∏ Side Effects</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/use-effect_small/">useEffect &amp; Side Effects - Senior Cheat Sheet</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Security</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../security/frontend-security/">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Frontend –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–π</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../security/frontend-security_small/">Frontend Security (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Testing</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../testing/strategies/">–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è frontend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../testing/strategies_small/">–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Frontend (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Typescript</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../typescript/advanced-types/">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–∏–ø—ã TypeScript</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../typescript/advanced-types_small/">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–∏–ø—ã TypeScript (small)</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">My Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Questions</li>
          <li class="breadcrumb-item">Architecture</li>
      <li class="breadcrumb-item active">Offline-First –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (small)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="offline-first-small">Offline-First –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (small)</h1>
<h2 id="offline-first">–ü—Ä–∏–Ω—Ü–∏–ø—ã Offline-First</h2>
<p><strong>–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã</strong>:
- IndexedDB –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- localStorage –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- Service Worker –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ</p>
<h2 id="indexeddb-offline-storage">IndexedDB –¥–ª—è Offline Storage</h2>
<pre><code class="language-javascript">class OfflineDatabase {
  constructor(dbName, version = 1) {
    this.dbName = dbName;
    this.version = version;
    this.db = null;
  }

  async init() {
    return new Promise((resolve, reject) =&gt; {
      const request = indexedDB.open(this.dbName, this.version);

      request.onsuccess = () =&gt; {
        this.db = request.result;
        resolve(this.db);
      };

      request.onupgradeneeded = (event) =&gt; {
        const db = event.target.result;
        this.createStores(db);
      };
    });
  }

  createStores(db) {
    // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    const dataStore = db.createObjectStore('posts', { keyPath: 'id' });
    dataStore.createIndex('timestamp', 'timestamp');

    // –û—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    const syncStore = db.createObjectStore('syncQueue', { keyPath: 'id', autoIncrement: true });
    syncStore.createIndex('operation', 'operation');
  }

  async get(storeName, id) {
    const transaction = this.db.transaction([storeName], 'readonly');
    const store = transaction.objectStore(storeName);
    return new Promise((resolve, reject) =&gt; {
      const request = store.get(id);
      request.onsuccess = () =&gt; resolve(request.result);
      request.onerror = () =&gt; reject(request.error);
    });
  }

  async put(storeName, data) {
    const transaction = this.db.transaction([storeName], 'readwrite');
    const store = transaction.objectStore(storeName);
    return new Promise((resolve, reject) =&gt; {
      const request = store.put(data);
      request.onsuccess = () =&gt; resolve(request.result);
      request.onerror = () =&gt; reject(request.error);
    });
  }
}
</code></pre>
<h2 id="offline-first-data-service">Offline-First Data Service</h2>
<pre><code class="language-javascript">class OfflineDataService {
  constructor(database, syncService) {
    this.db = database;
    this.syncService = syncService;
  }

  // –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
  async create(data) {
    const item = {
      id: this.generateOfflineId(),
      ...data,
      timestamp: Date.now(),
      status: 'pending',
      version: 1
    };

    await this.db.put('posts', item);
    await this.syncService.addToQueue('CREATE', item);
    return item;
  }

  async update(id, updates) {
    const existing = await this.db.get('posts', id);
    const updated = {
      ...existing,
      ...updates,
      version: existing.version + 1,
      lastModified: Date.now(),
      status: 'pending'
    };

    await this.db.put('posts', updated);
    await this.syncService.addToQueue('UPDATE', updated);
    return updated;
  }

  async delete(id) {
    const item = await this.db.get('posts', id);

    if (item.status === 'pending') {
      // –õ–æ–∫–∞–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
      await this.db.delete('posts', id);
      await this.syncService.removeFromQueue('CREATE', { id });
    } else {
      // –ü–æ–º–µ—á–∞–µ–º –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
      await this.db.put('posts', { ...item, isDeleted: true, deletedAt: Date.now() });
      await this.syncService.addToQueue('DELETE', { id });
    }
  }

  generateOfflineId() {
    return `offline_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }
}
</code></pre>
<h2 id="_1">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</h2>
<pre><code class="language-javascript">class SyncService {
  constructor(database, apiClient) {
    this.db = database;
    this.api = apiClient;
    this.isOnline = navigator.onLine;
    this.isSyncing = false;

    window.addEventListener('online', () =&gt; {
      this.isOnline = true;
      this.startSync();
    });
  }

  async addToQueue(operation, data) {
    const queueItem = {
      operation,
      data,
      timestamp: Date.now(),
      attempts: 0
    };

    await this.db.put('syncQueue', queueItem);

    if (this.isOnline) this.startSync();
  }

  async startSync() {
    if (!this.isOnline || this.isSyncing) return;

    this.isSyncing = true;

    try {
      await this.downloadChanges();
      await this.uploadChanges();
    } finally {
      this.isSyncing = false;
    }
  }

  async downloadChanges() {
    const lastSync = await this.getLastSyncTime();
    const changes = await this.api.getChanges({ since: lastSync });

    for (const change of changes) {
      await this.applyRemoteChange(change);
    }
  }

  async uploadChanges() {
    const queue = await this.db.getAll('syncQueue');

    for (const item of queue) {
      try {
        await this.processQueueItem(item);
        await this.db.delete('syncQueue', item.id);
      } catch (error) {
        if (++item.attempts &gt;= 3) {
          await this.db.delete('syncQueue', item.id);
        }
      }
    }
  }

  async processQueueItem(item) {
    switch (item.operation) {
      case 'CREATE':
        const serverItem = await this.api.create(item.data);
        await this.updateLocalWithServerData(item.data.id, serverItem);
        break;
      case 'UPDATE':
        const updated = await this.api.update(item.data.id, item.data);
        await this.updateLocalWithServerData(item.data.id, updated);
        break;
      case 'DELETE':
        await this.api.delete(item.data.id);
        await this.db.delete('posts', item.data.id);
        break;
    }
  }
}
</code></pre>
<h2 id="_2">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤</h2>
<pre><code class="language-javascript">class ConflictResolver {
  resolve(localData, remoteData) {
    const strategy = this.selectStrategy(localData, remoteData);

    switch (strategy) {
      case 'last-write-wins':
        return this.lastWriteWins(localData, remoteData);
      case 'merge-fields':
        return this.mergeFields(localData, remoteData);
      case 'user-choice':
        return this.requestUserChoice(localData, remoteData);
    }
  }

  selectStrategy(localData, remoteData) {
    const criticalFields = ['title', 'content'];
    const hasConflict = criticalFields.some(field =&gt; 
      localData[field] !== remoteData[field]
    );

    return hasConflict ? 'user-choice' : 'merge-fields';
  }

  lastWriteWins(localData, remoteData) {
    const localTime = localData.lastModified || localData.timestamp;
    const remoteTime = remoteData.lastModified || remoteData.timestamp;
    return localTime &gt; remoteTime ? localData : remoteData;
  }

  mergeFields(localData, remoteData) {
    return {
      ...remoteData,
      ...localData,
      tags: [...new Set([...(localData.tags || []), ...(remoteData.tags || [])])],
      lastModified: Math.max(
        localData.lastModified || 0,
        remoteData.lastModified || 0
      )
    };
  }

  async requestUserChoice(localData, remoteData) {
    return new Promise((resolve) =&gt; {
      window.dispatchEvent(new CustomEvent('conflict-resolution', {
        detail: { local: localData, remote: remoteData, resolve }
      }));
    });
  }
}
</code></pre>
<h2 id="react-hooks-offline-first">React Hooks –¥–ª—è Offline-First</h2>
<pre><code class="language-javascript">const useOfflineData = (storeName) =&gt; {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [isOnline, setIsOnline] = useState(navigator.onLine);

  const dbRef = useRef(null);
  const serviceRef = useRef(null);

  useEffect(() =&gt; {
    const initOffline = async () =&gt; {
      dbRef.current = new OfflineDatabase('AppDB');
      await dbRef.current.init();

      serviceRef.current = new OfflineDataService(
        dbRef.current,
        new SyncService(dbRef.current, new APIClient())
      );

      await loadData();
      setLoading(false);
    };

    initOffline();
  }, []);

  const loadData = async () =&gt; {
    const items = await dbRef.current.getAll(storeName);
    setData(items.filter(item =&gt; !item.isDeleted));
  };

  const create = useCallback(async (itemData) =&gt; {
    const item = await serviceRef.current.create(itemData);
    await loadData();
    return item;
  }, []);

  const update = useCallback(async (id, updates) =&gt; {
    const item = await serviceRef.current.update(id, updates);
    await loadData();
    return item;
  }, []);

  const remove = useCallback(async (id) =&gt; {
    await serviceRef.current.delete(id);
    await loadData();
  }, []);

  return { data, loading, isOnline, create, update, remove };
};

// Sync status hook
const useSyncStatus = () =&gt; {
  const [status, setStatus] = useState({
    isSyncing: false,
    pendingCount: 0,
    lastSync: null
  });

  useEffect(() =&gt; {
    const updateStatus = async () =&gt; {
      // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç sync service
      if (window.syncService) {
        const newStatus = await window.syncService.getStatus();
        setStatus(newStatus);
      }
    };

    const interval = setInterval(updateStatus, 5000);
    return () =&gt; clearInterval(interval);
  }, []);

  return status;
};
</code></pre>
<h2 id="service-worker-offline-first">Service Worker –¥–ª—è Offline-First</h2>
<pre><code class="language-javascript">// sw.js - Offline-first caching strategy
const CACHE_NAME = 'offline-first-v1';
const APP_SHELL = ['/', '/static/js/bundle.js', '/static/css/main.css'];

// Offline-first –¥–ª—è API
self.addEventListener('fetch', (event) =&gt; {
  const { request } = event;

  if (request.url.includes('/api/')) {
    event.respondWith(
      // –°–Ω–∞—á–∞–ª–∞ –∫–µ—à, –ø–æ—Ç–æ–º —Å–µ—Ç—å
      caches.match(request)
        .then(cachedResponse =&gt; {
          if (cachedResponse) return cachedResponse;

          return fetch(request)
            .then(response =&gt; {
              if (response.status === 200) {
                const responseClone = response.clone();
                caches.open(CACHE_NAME)
                  .then(cache =&gt; cache.put(request, responseClone));
              }
              return response;
            })
            .catch(() =&gt; {
              return new Response(JSON.stringify({
                error: 'Network unavailable',
                offline: true
              }), {
                headers: { 'Content-Type': 'application/json' }
              });
            });
        })
    );
  }
});

// Background sync
self.addEventListener('sync', (event) =&gt; {
  if (event.tag === 'background-sync') {
    event.waitUntil(handleBackgroundSync());
  }
});

async function handleBackgroundSync() {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  const db = await openDatabase();
  const queue = await getAllFromStore(db, 'syncQueue');

  for (const item of queue) {
    try {
      await syncItem(item);
      await deleteFromStore(db, 'syncQueue', item.id);
    } catch (error) {
      console.error('Background sync failed:', error);
    }
  }
}
</code></pre>
<h2 id="_3">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</h2>
<pre><code class="language-javascript">class OfflineOptimizer {
  constructor() {
    this.batteryOptimized = false;
    this.connectionQuality = 'good';
    this.setupMonitoring();
  }

  async setupMonitoring() {
    // Battery API
    if ('getBattery' in navigator) {
      const battery = await navigator.getBattery();
      this.batteryOptimized = battery.level &lt; 0.2;
    }

    // Network Information API
    if ('connection' in navigator) {
      const connection = navigator.connection;
      this.connectionQuality = this.getConnectionQuality(connection.effectiveType);
    }
  }

  getConnectionQuality(effectiveType) {
    const qualityMap = {
      'slow-2g': 'poor',
      '2g': 'poor',
      '3g': 'moderate',
      '4g': 'good'
    };
    return qualityMap[effectiveType] || 'good';
  }

  getSyncInterval() {
    if (this.batteryOptimized) return 300000; // 5 min

    switch (this.connectionQuality) {
      case 'poor': return 120000; // 2 min
      case 'moderate': return 60000; // 1 min
      default: return 30000; // 30 sec
    }
  }

  shouldOptimizeSync() {
    return this.batteryOptimized || this.connectionQuality === 'poor';
  }
}
</code></pre>
<h2 id="sync-status-component">Sync Status Component</h2>
<pre><code class="language-javascript">function SyncStatusIndicator() {
  const { isSyncing, pendingCount, lastSync } = useSyncStatus();
  const isOnline = navigator.onLine;

  const getStatusText = () =&gt; {
    if (!isOnline) return 'Offline';
    if (isSyncing) return 'Syncing...';
    if (pendingCount &gt; 0) return `Pending: ${pendingCount}`;
    return 'Synced';
  };

  const getStatusColor = () =&gt; {
    if (!isOnline) return 'orange';
    if (isSyncing) return 'blue';
    if (pendingCount &gt; 0) return 'yellow';
    return 'green';
  };

  return (
    &lt;div className={`sync-status ${getStatusColor()}`}&gt;
      &lt;div className=&quot;indicator&quot; /&gt;
      &lt;span&gt;{getStatusText()}&lt;/span&gt;
      {lastSync &amp;&amp; &lt;small&gt;Last: {new Date(lastSync).toLocaleTimeString()}&lt;/small&gt;}
    &lt;/div&gt;
  );
}
</code></pre>
<h2 id="offline-first_1">–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã Offline-First</h2>
<p><strong>Local-First Philosophy</strong>:
- –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ</p>
<p><strong>Sync Strategies</strong>:</p>
<pre><code class="language-javascript">const syncStrategies = {
  immediate: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏',
  batched: '–ì—Ä—É–ø–ø–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã',
  manual: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
  background: '–§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Service Worker'
};
</code></pre>
<p><strong>Conflict Resolution</strong>:
- <strong>Last Write Wins</strong>: –ü—Ä–æ—Å—Ç–æ–π, –Ω–æ –º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ
- <strong>Manual Resolution</strong>: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≤–µ—Ä—Å–∏—é
- <strong>Automatic Merge</strong>: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º
- <strong>Vector Clocks</strong>: –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤</p>
<h2 id="data-consistency-models">Data Consistency Models</h2>
<table>
<thead>
<tr>
<th>Model</th>
<th>Consistency</th>
<th>Availability</th>
<th>Partition Tolerance</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Strong Consistency</strong></td>
<td>–í—ã—Å–æ–∫–∞—è</td>
<td>–ù–∏–∑–∫–∞—è</td>
<td>–ù–∏–∑–∫–∞—è</td>
</tr>
<tr>
<td><strong>Eventual Consistency</strong></td>
<td>–ù–∏–∑–∫–∞—è</td>
<td>–í—ã—Å–æ–∫–∞—è</td>
<td>–í—ã—Å–æ–∫–∞—è</td>
</tr>
<tr>
<td><strong>Causal Consistency</strong></td>
<td>–°—Ä–µ–¥–Ω—è—è</td>
<td>–í—ã—Å–æ–∫–∞—è</td>
<td>–í—ã—Å–æ–∫–∞—è</td>
</tr>
</tbody>
</table>
<p>Offline-first –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <strong>Eventual Consistency</strong>.</p>
<h2 id="storage-limits">Storage Limits –∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
<pre><code class="language-javascript">// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–æ—Ç–∞–º–∏
const checkStorageQuota = async () =&gt; {
  if ('storage' in navigator &amp;&amp; 'estimate' in navigator.storage) {
    const estimate = await navigator.storage.estimate();
    return {
      used: estimate.usage,
      available: estimate.quota,
      percentage: (estimate.usage / estimate.quota) * 100
    };
  }
};

// –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
const cleanupOldData = async (db, maxAge = 30 * 24 * 60 * 60 * 1000) =&gt; {
  const cutoff = Date.now() - maxAge;
  const oldItems = await db.getAll('posts', 'timestamp', IDBKeyRange.upperBound(cutoff));

  for (const item of oldItems) {
    if (item.status === 'synced') {
      await db.delete('posts', item.id);
    }
  }
};
</code></pre>
<h2 id="best-practices-senior-level">Best Practices Senior-level</h2>
<ol>
<li><strong>Progressive Enhancement</strong>: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–µ—Ç–∏</li>
<li><strong>Optimistic UI</strong>: –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</li>
<li><strong>Conflict Resolution</strong>: –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤</li>
<li><strong>Battery Optimization</strong>: –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –±–∞—Ç–∞—Ä–µ–∏</li>
<li><strong>Storage Management</strong>: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–æ—Ç–∞–º–∏ –∏ –æ—á–∏—Å—Ç–∫–∞</li>
<li><strong>Background Sync</strong>: Service Worker –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</li>
<li><strong>User Feedback</strong>: –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</li>
</ol>
<h2 id="senior">–ß–∞—Å—Ç—ã–µ Senior –≤–æ–ø—Ä–æ—Å—ã</h2>
<ul>
<li><strong>–ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å eventual consistency –≤ offline-first –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö?</strong></li>
<li><strong>–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö?</strong></li>
<li><strong>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤?</strong></li>
<li><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ storage quota –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö?</strong></li>
<li><strong>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ offline functionality?</strong></li>
<li><strong>–ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –≤ IndexedDB?</strong></li>
<li><strong>Performance considerations –¥–ª—è –±–æ–ª—å—à–∏—Ö offline datasets?</strong></li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../offline-first/" class="btn btn-neutral float-left" title="Offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../resilient-frontend/" class="btn btn-neutral float-right" title="–£—Å—Ç–æ–π—á–∏–≤–∞—è frontend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../offline-first/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../resilient-frontend/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
