<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - My Docs</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Offline-first \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430";
        var mkdocs_page_input_path = "questions/architecture/offline-first.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> My Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">üìö –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é: JavaScript, React –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Questions</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Architecture</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../ddd/">Domain-Driven Design (DDD) –≤–æ Frontend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ddd_small/">Domain-Driven Design (DDD) –≤–æ Frontend (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../microfrontends/">–ú–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã (Microfrontends)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../microfrontends_small/">Microfrontends - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#_1">–û–ø–∏—Å–∞–Ω–∏–µ</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_2">–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#offline-first_1">–ü—Ä–∏–Ω—Ü–∏–ø—ã Offline-First</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#react-integration-offline-first">React Integration –¥–ª—è Offline-First</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_3">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#progressive-web-app">Progressive Web App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../offline-first_small/">Offline-First –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../resilient-frontend/">–£—Å—Ç–æ–π—á–∏–≤–∞—è frontend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../resilient-frontend_small/">–£—Å—Ç–æ–π—á–∏–≤–∞—è Frontend –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../state-management/">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../state-management_small/">State Management Architecture - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../websockets-realtime/">WebSockets –∏ real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../websockets-realtime_small/">WebSockets –∏ Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Javascript</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/async-programming/">Promises, Async/Await –∏ Generators</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/async-programming_small/">Async Programming - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/currying/">Currying –≤ JavaScript</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/currying_small/">Currying - –®–ø–∞—Ä–≥–∞–ª–∫–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/event-loop/">Event Loop, Microtasks –∏ Macrotasks</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/event-loop_small/">Event Loop - –®–ø–∞—Ä–≥–∞–ª–∫–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/execution-model/">–ú–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è JavaScript</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/execution-model_small/">JavaScript Execution Model - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/garbage-collection/">Garbage Collection –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/garbage-collection_small/">Garbage Collection - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/scope-hoisting/">Let, Const, Var: Scope –∏ Hoisting</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/scope-hoisting_small/">Let, Const, Var - –®–ø–∞—Ä–≥–∞–ª–∫–∞ (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/typing-comparison/">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ JS –∏ Java</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../javascript/typing-comparison_small/">JS vs Java Typing + TypeScript - Senior Cheat Sheet (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Performance</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../performance/optimization/">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ frontend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../performance/optimization_small/">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Frontend (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >React</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../react/concurrent-rendering/">–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ React 18</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/concurrent-rendering_small/">React 18 Concurrent Rendering - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/context-api/">Context API vs Redux</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/context-api_small/">Context API vs Redux - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/hoc/">Higher-Order Components (HOC)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/hoc_small/">Higher-Order Components - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/reconciliation/">Reconciliation –∏ Virtual DOM</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/reconciliation_small/">Reconciliation &amp; Virtual DOM - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/rerender-optimization/">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤ –≤ React</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/rerender-optimization_small/">React Rerender Optimization - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/ssr-rsc/">SSR/SSG –∏ React Server Components</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/ssr-rsc_small/">SSR/SSG &amp; React Server Components - Senior Cheat Sheet (small)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/use-effect/">useEffect –∏ Side Effects</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../react/use-effect_small/">useEffect &amp; Side Effects - Senior Cheat Sheet</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Security</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../security/frontend-security/">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Frontend –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–π</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../security/frontend-security_small/">Frontend Security (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Testing</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../testing/strategies/">–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è frontend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../testing/strategies_small/">–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Frontend (small)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Typescript</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../typescript/advanced-types/">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–∏–ø—ã TypeScript</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../typescript/advanced-types_small/">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–∏–ø—ã TypeScript (small)</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">My Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Questions</li>
          <li class="breadcrumb-item">Architecture</li>
      <li class="breadcrumb-item active">Offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="offline-first">Offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h1>
<h2 id="_1">–û–ø–∏—Å–∞–Ω–∏–µ</h2>
<p>–í–æ–ø—Ä–æ—Å –∫–∞—Å–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ, —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –≠—Ç–æ –ø–æ–¥—Ö–æ–¥, –≥–¥–µ offline-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π, –∞ –Ω–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π.</p>
<h2 id="_2">–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</h2>
<h3 id="offline-first_1">–ü—Ä–∏–Ω—Ü–∏–ø—ã Offline-First</h3>
<h4 id="1">1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã</h4>
<p>–í offline-first –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö.</p>
<pre><code class="language-javascript">// –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å IndexedDB
class OfflineDatabase {
  constructor(dbName, version = 1) {
    this.dbName = dbName;
    this.version = version;
    this.db = null;
  }

  async init() {
    return new Promise((resolve, reject) =&gt; {
      const request = indexedDB.open(this.dbName, this.version);

      request.onerror = () =&gt; reject(request.error);
      request.onsuccess = () =&gt; {
        this.db = request.result;
        resolve(this.db);
      };

      request.onupgradeneeded = (event) =&gt; {
        const db = event.target.result;

        // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–Ω—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â
        this.createStores(db);
      };
    });
  }

  createStores(db) {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    if (!db.objectStoreNames.contains('users')) {
      const userStore = db.createObjectStore('users', { keyPath: 'id' });
      userStore.createIndex('email', 'email', { unique: true });
    }

    // –ü–æ—Å—Ç—ã
    if (!db.objectStoreNames.contains('posts')) {
      const postStore = db.createObjectStore('posts', { keyPath: 'id' });
      postStore.createIndex('authorId', 'authorId');
      postStore.createIndex('timestamp', 'timestamp');
    }

    // –û—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    if (!db.objectStoreNames.contains('syncQueue')) {
      const syncStore = db.createObjectStore('syncQueue', { keyPath: 'id', autoIncrement: true });
      syncStore.createIndex('operation', 'operation');
      syncStore.createIndex('timestamp', 'timestamp');
    }

    // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    if (!db.objectStoreNames.contains('metadata')) {
      db.createObjectStore('metadata', { keyPath: 'key' });
    }
  }

  async get(storeName, id) {
    const transaction = this.db.transaction([storeName], 'readonly');
    const store = transaction.objectStore(storeName);

    return new Promise((resolve, reject) =&gt; {
      const request = store.get(id);
      request.onsuccess = () =&gt; resolve(request.result);
      request.onerror = () =&gt; reject(request.error);
    });
  }

  async getAll(storeName, indexName = null, range = null) {
    const transaction = this.db.transaction([storeName], 'readonly');
    const store = transaction.objectStore(storeName);
    const source = indexName ? store.index(indexName) : store;

    return new Promise((resolve, reject) =&gt; {
      const request = source.getAll(range);
      request.onsuccess = () =&gt; resolve(request.result);
      request.onerror = () =&gt; reject(request.error);
    });
  }

  async put(storeName, data) {
    const transaction = this.db.transaction([storeName], 'readwrite');
    const store = transaction.objectStore(storeName);

    return new Promise((resolve, reject) =&gt; {
      const request = store.put(data);
      request.onsuccess = () =&gt; resolve(request.result);
      request.onerror = () =&gt; reject(request.error);
    });
  }

  async delete(storeName, id) {
    const transaction = this.db.transaction([storeName], 'readwrite');
    const store = transaction.objectStore(storeName);

    return new Promise((resolve, reject) =&gt; {
      const request = store.delete(id);
      request.onsuccess = () =&gt; resolve(request.result);
      request.onerror = () =&gt; reject(request.error);
    });
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
const offlineDB = new OfflineDatabase('AppDatabase');
await offlineDB.init();
</code></pre>
<h4 id="2">2. –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π</h4>
<pre><code class="language-javascript">// –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å—Ç–∞–º–∏ (offline-first)
class PostService {
  constructor(database, syncService) {
    this.db = database;
    this.syncService = syncService;
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ (—Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)
  async createPost(postData) {
    const post = {
      id: this.generateOfflineId(),
      ...postData,
      timestamp: Date.now(),
      status: 'pending', // pending, synced, conflict
      version: 1,
      isLocalChange: true
    };

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î
    await this.db.put('posts', post);

    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    await this.syncService.addToQueue({
      type: 'CREATE_POST',
      data: post,
      timestamp: Date.now()
    });

    return post;
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
  async updatePost(id, updates) {
    const existingPost = await this.db.get('posts', id);
    if (!existingPost) {
      throw new Error('Post not found');
    }

    const updatedPost = {
      ...existingPost,
      ...updates,
      version: existingPost.version + 1,
      lastModified: Date.now(),
      isLocalChange: true,
      status: existingPost.status === 'synced' ? 'pending' : existingPost.status
    };

    await this.db.put('posts', updatedPost);

    await this.syncService.addToQueue({
      type: 'UPDATE_POST',
      data: updatedPost,
      timestamp: Date.now()
    });

    return updatedPost;
  }

  // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
  async deletePost(id) {
    const post = await this.db.get('posts', id);
    if (!post) return;

    if (post.isLocalChange &amp;&amp; post.status === 'pending') {
      // –ï—Å–ª–∏ –ø–æ—Å—Ç –µ—â–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
      await this.db.delete('posts', id);
      await this.syncService.removeFromQueue('CREATE_POST', { id });
    } else {
      // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–π –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
      const deletedPost = {
        ...post,
        isDeleted: true,
        deletedAt: Date.now(),
        status: 'pending'
      };

      await this.db.put('posts', deletedPost);

      await this.syncService.addToQueue({
        type: 'DELETE_POST',
        data: { id },
        timestamp: Date.now()
      });
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ (–≤—Å–µ–≥–¥–∞ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î)
  async getPosts(filters = {}) {
    let posts = await this.db.getAll('posts');

    // –§–∏–ª—å—Ç—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã
    posts = posts.filter(post =&gt; !post.isDeleted);

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
    if (filters.authorId) {
      posts = posts.filter(post =&gt; post.authorId === filters.authorId);
    }

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
    posts.sort((a, b) =&gt; b.timestamp - a.timestamp);

    return posts;
  }

  generateOfflineId() {
    return `offline_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }
}
</code></pre>
<h4 id="3">3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</h4>
<pre><code class="language-javascript">// –°–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
class SyncService {
  constructor(database, apiClient) {
    this.db = database;
    this.api = apiClient;
    this.isOnline = navigator.onLine;
    this.isSyncing = false;
    this.conflictResolver = new ConflictResolver();

    this.setupEventListeners();
  }

  setupEventListeners() {
    window.addEventListener('online', () =&gt; {
      this.isOnline = true;
      this.startSync();
    });

    window.addEventListener('offline', () =&gt; {
      this.isOnline = false;
    });
  }

  async addToQueue(operation) {
    const queueItem = {
      ...operation,
      id: crypto.randomUUID(),
      attempts: 0,
      maxAttempts: 3
    };

    await this.db.put('syncQueue', queueItem);

    if (this.isOnline &amp;&amp; !this.isSyncing) {
      this.startSync();
    }
  }

  async removeFromQueue(type, criteria) {
    const queue = await this.db.getAll('syncQueue');
    const itemsToRemove = queue.filter(item =&gt; 
      item.type === type &amp;&amp; 
      Object.keys(criteria).every(key =&gt; item.data[key] === criteria[key])
    );

    for (const item of itemsToRemove) {
      await this.db.delete('syncQueue', item.id);
    }
  }

  async startSync() {
    if (!this.isOnline || this.isSyncing) return;

    this.isSyncing = true;

    try {
      // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞
      await this.downloadChanges();

      // –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
      await this.uploadChanges();

      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
      await this.updateLastSyncTime();

      console.log('Sync completed successfully');
    } catch (error) {
      console.error('Sync failed:', error);
    } finally {
      this.isSyncing = false;
    }
  }

  async downloadChanges() {
    const lastSync = await this.getLastSyncTime();

    try {
      const changes = await this.api.getChanges({ since: lastSync });

      for (const change of changes) {
        await this.applyRemoteChange(change);
      }
    } catch (error) {
      console.error('Failed to download changes:', error);
      throw error;
    }
  }

  async applyRemoteChange(change) {
    const { type, data } = change;
    const localData = await this.db.get('posts', data.id);

    if (localData &amp;&amp; localData.isLocalChange &amp;&amp; localData.status === 'pending') {
      // –ö–æ–Ω—Ñ–ª–∏–∫—Ç: –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ, –∏ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
      const resolution = await this.conflictResolver.resolve(localData, data);
      await this.db.put('posts', resolution);
    } else {
      // –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
      const updatedData = {
        ...data,
        status: 'synced',
        isLocalChange: false
      };
      await this.db.put('posts', updatedData);
    }
  }

  async uploadChanges() {
    const queue = await this.db.getAll('syncQueue');

    for (const item of queue) {
      try {
        await this.processQueueItem(item);
        await this.db.delete('syncQueue', item.id);
      } catch (error) {
        item.attempts++;

        if (item.attempts &gt;= item.maxAttempts) {
          console.error(`Failed to sync item after ${item.maxAttempts} attempts:`, item);
          await this.db.delete('syncQueue', item.id);
        } else {
          await this.db.put('syncQueue', item);
        }
      }
    }
  }

  async processQueueItem(item) {
    const { type, data } = item;

    switch (type) {
      case 'CREATE_POST':
        const serverPost = await this.api.createPost(data);
        await this.updateLocalWithServerData(data.id, serverPost);
        break;

      case 'UPDATE_POST':
        const updatedPost = await this.api.updatePost(data.id, data);
        await this.updateLocalWithServerData(data.id, updatedPost);
        break;

      case 'DELETE_POST':
        await this.api.deletePost(data.id);
        await this.db.delete('posts', data.id);
        break;

      default:
        throw new Error(`Unknown sync operation: ${type}`);
    }
  }

  async updateLocalWithServerData(localId, serverData) {
    const updatedData = {
      ...serverData,
      status: 'synced',
      isLocalChange: false
    };

    // –ï—Å–ª–∏ ID –∏–∑–º–µ–Ω–∏–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏), –æ–±–Ω–æ–≤–ª—è–µ–º
    if (localId !== serverData.id) {
      await this.db.delete('posts', localId);
    }

    await this.db.put('posts', updatedData);
  }

  async getLastSyncTime() {
    const metadata = await this.db.get('metadata', 'lastSyncTime');
    return metadata ? metadata.value : 0;
  }

  async updateLastSyncTime() {
    await this.db.put('metadata', {
      key: 'lastSyncTime',
      value: Date.now()
    });
  }
}
</code></pre>
<h4 id="4">4. –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤</h4>
<pre><code class="language-javascript">// –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
class ConflictResolver {
  async resolve(localData, remoteData) {
    // –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
    const strategy = this.selectStrategy(localData, remoteData);

    switch (strategy) {
      case 'last-write-wins':
        return this.lastWriteWins(localData, remoteData);

      case 'merge-fields':
        return this.mergeFields(localData, remoteData);

      case 'user-choice':
        return this.requestUserChoice(localData, remoteData);

      default:
        return this.lastWriteWins(localData, remoteData);
    }
  }

  selectStrategy(localData, remoteData) {
    // –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π —Ç—Ä–µ–±—É–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const criticalFields = ['title', 'content'];
    const hasConflictInCriticalFields = criticalFields.some(field =&gt; 
      localData[field] !== remoteData[field]
    );

    if (hasConflictInCriticalFields) {
      return 'user-choice';
    }

    // –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –ø–æ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–∏—è–Ω–∏–µ
    return 'merge-fields';
  }

  lastWriteWins(localData, remoteData) {
    const localTime = localData.lastModified || localData.timestamp;
    const remoteTime = remoteData.lastModified || remoteData.timestamp;

    return localTime &gt; remoteTime ? localData : remoteData;
  }

  mergeFields(localData, remoteData) {
    // –ü—Ä–æ—Å—Ç–æ–µ —Å–ª–∏—è–Ω–∏–µ –ø–æ–ª–µ–π
    return {
      ...remoteData,
      ...localData,
      // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
      tags: [...new Set([
        ...(localData.tags || []),
        ...(remoteData.tags || [])
      ])],
      lastModified: Math.max(
        localData.lastModified || 0,
        remoteData.lastModified || 0
      )
    };
  }

  async requestUserChoice(localData, remoteData) {
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞
    return new Promise((resolve) =&gt; {
      const conflictData = {
        local: localData,
        remote: remoteData,
        resolve
      };

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø–æ–∫–∞–∑–∞ UI —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
      window.dispatchEvent(new CustomEvent('conflict-resolution-needed', {
        detail: conflictData
      }));
    });
  }
}

// React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
function ConflictResolutionModal({ local, remote, onResolve }) {
  const [selectedVersion, setSelectedVersion] = useState(null);
  const [customResolution, setCustomResolution] = useState(null);

  useEffect(() =&gt; {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
    setCustomResolution({ ...local });
  }, [local]);

  const handleResolve = () =&gt; {
    let resolution;

    switch (selectedVersion) {
      case 'local':
        resolution = local;
        break;
      case 'remote':
        resolution = remote;
        break;
      case 'custom':
        resolution = customResolution;
        break;
      default:
        resolution = local; // fallback
    }

    onResolve(resolution);
  };

  return (
    &lt;div className=&quot;conflict-modal&quot;&gt;
      &lt;h3&gt;–ö–æ–Ω—Ñ–ª–∏–∫—Ç –¥–∞–Ω–Ω—ã—Ö&lt;/h3&gt;
      &lt;p&gt;–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –≤–µ—Ä—Å–∏—è–º–∏:&lt;/p&gt;

      &lt;div className=&quot;versions-comparison&quot;&gt;
        &lt;div className=&quot;version&quot;&gt;
          &lt;h4&gt;–õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è&lt;/h4&gt;
          &lt;label&gt;
            &lt;input
              type=&quot;radio&quot;
              name=&quot;version&quot;
              value=&quot;local&quot;
              onChange={(e) =&gt; setSelectedVersion(e.target.value)}
            /&gt;
            –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –≤–µ—Ä—Å–∏—é
          &lt;/label&gt;
          &lt;pre&gt;{JSON.stringify(local, null, 2)}&lt;/pre&gt;
        &lt;/div&gt;

        &lt;div className=&quot;version&quot;&gt;
          &lt;h4&gt;–°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è&lt;/h4&gt;
          &lt;label&gt;
            &lt;input
              type=&quot;radio&quot;
              name=&quot;version&quot;
              value=&quot;remote&quot;
              onChange={(e) =&gt; setSelectedVersion(e.target.value)}
            /&gt;
            –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –≤–µ—Ä—Å–∏—é
          &lt;/label&gt;
          &lt;pre&gt;{JSON.stringify(remote, null, 2)}&lt;/pre&gt;
        &lt;/div&gt;

        &lt;div className=&quot;version&quot;&gt;
          &lt;h4&gt;–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é&lt;/h4&gt;
          &lt;label&gt;
            &lt;input
              type=&quot;radio&quot;
              name=&quot;version&quot;
              value=&quot;custom&quot;
              onChange={(e) =&gt; setSelectedVersion(e.target.value)}
            /&gt;
            –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
          &lt;/label&gt;
          {selectedVersion === 'custom' &amp;&amp; (
            &lt;textarea
              value={JSON.stringify(customResolution, null, 2)}
              onChange={(e) =&gt; {
                try {
                  setCustomResolution(JSON.parse(e.target.value));
                } catch (error) {
                  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤–æ –≤—Ä–µ–º—è –≤–≤–æ–¥–∞
                }
              }}
            /&gt;
          )}
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div className=&quot;modal-actions&quot;&gt;
        &lt;button onClick={handleResolve} disabled={!selectedVersion}&gt;
          –ü—Ä–∏–º–µ–Ω–∏—Ç—å
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h3 id="react-integration-offline-first">React Integration –¥–ª—è Offline-First</h3>
<h4 id="custom-hooks-offline-first">Custom Hooks –¥–ª—è offline-first</h4>
<pre><code class="language-javascript">// Hook –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å offline-first –¥–∞–Ω–Ω—ã–º–∏
const useOfflineData = (storeName, dependencies = []) =&gt; {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isOnline, setIsOnline] = useState(navigator.onLine);

  const dbRef = useRef(null);
  const syncServiceRef = useRef(null);

  useEffect(() =&gt; {
    const initDatabase = async () =&gt; {
      try {
        dbRef.current = new OfflineDatabase('AppDatabase');
        await dbRef.current.init();

        syncServiceRef.current = new SyncService(
          dbRef.current,
          new APIClient()
        );

        await loadData();
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    initDatabase();
  }, []);

  useEffect(() =&gt; {
    const handleOnlineStatus = () =&gt; {
      setIsOnline(navigator.onLine);
    };

    window.addEventListener('online', handleOnlineStatus);
    window.addEventListener('offline', handleOnlineStatus);

    return () =&gt; {
      window.removeEventListener('online', handleOnlineStatus);
      window.removeEventListener('offline', handleOnlineStatus);
    };
  }, []);

  const loadData = async () =&gt; {
    if (!dbRef.current) return;

    try {
      const items = await dbRef.current.getAll(storeName);
      setData(items);
    } catch (err) {
      setError(err.message);
    }
  };

  const create = useCallback(async (itemData) =&gt; {
    if (!dbRef.current || !syncServiceRef.current) return;

    const item = {
      id: `offline_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      ...itemData,
      timestamp: Date.now(),
      status: 'pending',
      isLocalChange: true
    };

    await dbRef.current.put(storeName, item);
    await syncServiceRef.current.addToQueue({
      type: `CREATE_${storeName.toUpperCase()}`,
      data: item
    });

    await loadData();
    return item;
  }, [storeName]);

  const update = useCallback(async (id, updates) =&gt; {
    if (!dbRef.current || !syncServiceRef.current) return;

    const existing = await dbRef.current.get(storeName, id);
    if (!existing) throw new Error('Item not found');

    const updated = {
      ...existing,
      ...updates,
      lastModified: Date.now(),
      status: existing.status === 'synced' ? 'pending' : existing.status,
      isLocalChange: true
    };

    await dbRef.current.put(storeName, updated);
    await syncServiceRef.current.addToQueue({
      type: `UPDATE_${storeName.toUpperCase()}`,
      data: updated
    });

    await loadData();
    return updated;
  }, [storeName]);

  const remove = useCallback(async (id) =&gt; {
    if (!dbRef.current || !syncServiceRef.current) return;

    const item = await dbRef.current.get(storeName, id);
    if (!item) return;

    if (item.isLocalChange &amp;&amp; item.status === 'pending') {
      await dbRef.current.delete(storeName, id);
    } else {
      const deleted = {
        ...item,
        isDeleted: true,
        deletedAt: Date.now(),
        status: 'pending'
      };
      await dbRef.current.put(storeName, deleted);
    }

    await syncServiceRef.current.addToQueue({
      type: `DELETE_${storeName.toUpperCase()}`,
      data: { id }
    });

    await loadData();
  }, [storeName]);

  const sync = useCallback(async () =&gt; {
    if (syncServiceRef.current &amp;&amp; isOnline) {
      await syncServiceRef.current.startSync();
      await loadData();
    }
  }, [isOnline]);

  return {
    data: data.filter(item =&gt; !item.isDeleted),
    loading,
    error,
    isOnline,
    create,
    update,
    remove,
    sync,
    refresh: loadData
  };
};

// Hook –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
const useSyncStatus = () =&gt; {
  const [status, setStatus] = useState({
    isSyncing: false,
    pendingItems: 0,
    lastSync: null,
    conflicts: []
  });

  useEffect(() =&gt; {
    const updateStatus = async () =&gt; {
      if (window.syncService) {
        const newStatus = await window.syncService.getStatus();
        setStatus(newStatus);
      }
    };

    const interval = setInterval(updateStatus, 5000);
    updateStatus();

    return () =&gt; clearInterval(interval);
  }, []);

  return status;
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
function SyncStatusIndicator() {
  const syncStatus = useSyncStatus();
  const isOnline = navigator.onLine;

  const getStatusText = () =&gt; {
    if (!isOnline) return '–û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º';
    if (syncStatus.isSyncing) return '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
    if (syncStatus.pendingItems &gt; 0) return `–û–∂–∏–¥–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ${syncStatus.pendingItems}`;
    return '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
  };

  const getStatusColor = () =&gt; {
    if (!isOnline) return 'orange';
    if (syncStatus.isSyncing) return 'blue';
    if (syncStatus.pendingItems &gt; 0) return 'yellow';
    return 'green';
  };

  return (
    &lt;div className={`sync-status ${getStatusColor()}`}&gt;
      &lt;div className=&quot;status-indicator&quot; /&gt;
      &lt;span&gt;{getStatusText()}&lt;/span&gt;
      {syncStatus.lastSync &amp;&amp; (
        &lt;small&gt;
          –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: {new Date(syncStatus.lastSync).toLocaleTimeString()}
        &lt;/small&gt;
      )}
    &lt;/div&gt;
  );
}
</code></pre>
<h3 id="_3">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</h3>
<h4 id="_4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –∏ –±–∞—Ç–∞—Ä–µ–µ–π</h4>
<pre><code class="language-javascript">class OfflineOptimizer {
  constructor() {
    this.batteryOptimized = false;
    this.connectionQuality = 'good';
    this.setupBatteryMonitoring();
    this.setupConnectionMonitoring();
  }

  async setupBatteryMonitoring() {
    if ('getBattery' in navigator) {
      const battery = await navigator.getBattery();

      const updateBatteryOptimization = () =&gt; {
        this.batteryOptimized = battery.level &lt; 0.2 || !battery.charging;
      };

      battery.addEventListener('levelchange', updateBatteryOptimization);
      battery.addEventListener('chargingchange', updateBatteryOptimization);
      updateBatteryOptimization();
    }
  }

  setupConnectionMonitoring() {
    if ('connection' in navigator) {
      const connection = navigator.connection;

      const updateConnectionQuality = () =&gt; {
        const effectiveType = connection.effectiveType;

        if (effectiveType === 'slow-2g' || effectiveType === '2g') {
          this.connectionQuality = 'poor';
        } else if (effectiveType === '3g') {
          this.connectionQuality = 'moderate';
        } else {
          this.connectionQuality = 'good';
        }
      };

      connection.addEventListener('change', updateConnectionQuality);
      updateConnectionQuality();
    }
  }

  shouldOptimizeSync() {
    return this.batteryOptimized || this.connectionQuality === 'poor';
  }

  getSyncInterval() {
    if (this.shouldOptimizeSync()) {
      return 300000; // 5 –º–∏–Ω—É—Ç –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –∑–∞—Ä—è–¥–µ/–ø–ª–æ—Ö–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
    }

    switch (this.connectionQuality) {
      case 'poor': return 120000; // 2 –º–∏–Ω—É—Ç—ã
      case 'moderate': return 60000; // 1 –º–∏–Ω—É—Ç–∞
      default: return 30000; // 30 —Å–µ–∫—É–Ω–¥
    }
  }

  getMaxConcurrentSyncs() {
    if (this.batteryOptimized) return 1;

    switch (this.connectionQuality) {
      case 'poor': return 1;
      case 'moderate': return 2;
      default: return 5;
    }
  }
}
</code></pre>
<h3 id="progressive-web-app">Progressive Web App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</h3>
<h4 id="service-worker">–ú–∞–Ω–∏—Ñ–µ—Å—Ç –∏ Service Worker</h4>
<p>```javascript
// service-worker.js –¥–ª—è offline-first PWA
const CACHE_NAME = 'offline-first-v1';
const APP_SHELL = [
  '/',
  '/static/js/bundle.js',
  '/static/css/main.css',
  '/offline.html'
];</p>
<p>// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Service Worker
self.addEventListener('install', (event) =&gt; {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache =&gt; cache.addAll(APP_SHELL))
      .then(() =&gt; self.skipWaiting())
  );
});</p>
<p>// –ê–∫—Ç–∏–≤–∞—Ü–∏—è Service Worker
self.addEventListener('activate', (event) =&gt; {
  event.waitUntil(
    caches.keys()
      .then(cacheNames =&gt; {
        return Promise.all(
          cacheNames.map(cacheName =&gt; {
            if (cacheName !== CACHE_NAME) {
              return caches.delete(cacheName);
            }
          })
        );
      })
      .then(() =&gt; self.clients.claim())
  );
});</p>
<p>// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (offline-first —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
self.addEventListener('fetch', (event) =&gt; {
  const { request } = event;</p>
<p>// –î–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º cache-first —Å network fallback
  if (request.url.includes('/api/')) {
    event.respondWith(
      caches.match(request)
        .then(cachedResponse =&gt; {
          if (cachedResponse) {
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
            return cachedResponse;
          }</p>
<pre><code>      // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —Å–µ—Ç–∏
      return fetch(request)
        .then(response =&gt; {
          // –ö–µ—à–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
          if (response.status === 200) {
            const responseClone = response.clone();
            caches.open(CACHE_NAME)
              .then(cache =&gt; cache.put(request, responseClone));
          }
          return response;
        })
        .catch(() =&gt; {
          // –ï—Å–ª–∏ —Å–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
          return new Response(JSON.stringify({
            error: 'Network unavailable',
            offline: true
          }), {
            headers: { 'Content-
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../microfrontends_small/" class="btn btn-neutral float-left" title="Microfrontends - Senior Cheat Sheet (small)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../offline-first_small/" class="btn btn-neutral float-right" title="Offline-First –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (small)">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../microfrontends_small/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../offline-first_small/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
