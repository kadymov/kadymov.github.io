# Микрофронтенды (Microfrontends) (TTS)

Этот вопрос касается архитектурного подхода микрофронтендов - разделения монолитного фронтенд-приложения на независимые, автономно развиваемые части, каждая из которых принадлежит отдельной команде.

Что такое микрофронтенды

Микрофронтенды - это архитектурный стиль, где независимо развиваемые фронтенд-приложения составляют единое целое.

Основные принципы включают автономность команд, независимое развертывание, технологическую независимость и изоляцию кода и состояния.

Подходы к реализации

Build-time Integration
Интеграция на этапе сборки через NPM пакеты. Команды публикуют свои микрофронтенды как NPM пакеты, которые затем импортируются в основное приложение.

Преимущества: простота и оптимизация бандла.
Недостатки: необходимость пересборки всего приложения при изменениях.

Run-time Integration

iframe подход
Простой но ограниченный подход, где каждый микрофронтенд загружается в отдельном iframe.

Преимущества: полная изоляция между микрофронтендами.
Недостатки: сложности с коммуникацией, проблемы с производительностью и пользовательским опытом.

Module Federation
Webpack 5 предоставляет возможность Module Federation для динамической загрузки микрофронтендов во время выполнения. Хост-приложение может загружать удаленные модули с других серверов.

Single-SPA Framework
Single-SPA - это JavaScript фреймворк для создания микрофронтенд архитектуры. Он позволяет регистрировать приложения и активировать их на основе маршрутов.

Коммуникация между микрофронтендами

CustomEvents
Микрофронтенды могут общаться через пользовательские события браузера. Один микрофронтенд отправляет событие, а другие его прослушивают.

Shared State через EventBus
Можно создать глобальный EventBus для более структурированной коммуникации. EventBus позволяет подписываться на события, отправлять события и отписываться от них.

Shared Dependencies
Общие зависимости и сервисы могут быть доступны через глобальный объект window, что позволяет микрофронтендам использовать общие утилиты и состояние.

Стилизация и UI консистентность

Design System подход
Для поддержания консистентности интерфейса используется общий design system пакет. Все микрофронтенды используют одни и те же компоненты и темы оформления.

CSS-in-JS с префиксами
Для избежания конфликтов стилей используются автоматические префиксы для создания уникальных имен классов.

Маршрутизация в микрофронтендах

Single-SPA Router
Главное приложение управляет навигацией между микрофронтендами, а каждый микрофронтенд может иметь свою внутреннюю маршрутизацию.

Развертывание и DevOps

Independent Deployment Pipeline
Каждый микрофронтенд имеет свой собственный пайплайн развертывания. Изменения в одном микрофронтенде не требуют пересборки других.

Версионирование
Используется версионирование для управления совместимостью между микрофронтендами. Можно загружать определенные версии микрофронтендов.

Testing стратегии

Contract Testing
Контрактное тестирование проверяет, что микрофронтенды правильно взаимодействуют друг с другом через определенные интерфейсы.

Integration Testing
Интеграционные тесты проверяют работу всей системы микрофронтендов вместе.

Мониторинг и отладка

Error Boundaries
Каждый микрофронтенд должен быть обернут в Error Boundary для изоляции ошибок и предотвращения падения всего приложения.

Performance Monitoring
Важно мониторить производительность загрузки каждого микрофронтенда и их взаимодействие.

Преимущества и недостатки

Преимущества
Автономные команды могут независимо разрабатывать и развертывать свои части приложения.
Технологическое разнообразие - каждая команда может выбирать свой технологический стек.
Масштабируемость - легче масштабировать команды и кодовую базу.
Отказоустойчивость - падение одного микрофронтенда не влияет на работу остальных.

Недостатки
Сложность - увеличенная сложность архитектуры и инфраструктуры.
Производительность - дублирование зависимостей и больше HTTP запросов.
Консистентность - сложности с поддержанием единого пользовательского опыта.
Отладка - сложнее отлаживать взаимодействие между частями системы.

Best Practices

Начинайте с монолита - микрофронтенды это эволюция, а не стартовая точка.
Четкие границы - определите четкие границы ответственности для каждого микрофронтенда.
Shared dependencies - правильно управляйте общими зависимостями.
Consistent UX - используйте единую систему дизайна.
Monitoring - обязательный мониторинг и логирование.
Testing - инвестируйте в контрактное и интеграционное тестирование.

Рекомендации для собеседования

На Senior-уровне ожидается понимание различных подходов к реализации микрофронтендов, опыт работы с Module Federation или Single-SPA, знание проблем и способов их решения, понимание DevOps аспектов микрофронтендов, опыт с мониторингом и отладкой распределенных систем.

Частые вопросы на собеседованиях:
Когда стоит использовать микрофронтенды?
Как обеспечить консистентность UI между микрофронтендами?
Как тестировать взаимодействие между микрофронтендами?
Как решать проблемы производительности?
Как организовать CI/CD для микрофронтендов?

Этот материал связан с темами управления состоянием в распределенной архитектуре, оптимизации производительности и стратегиями тестирования.
