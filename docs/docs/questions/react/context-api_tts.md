# Context API vs Redux (TTS)

Вопрос: Как использовать Context API в React для управления состоянием, и когда его предпочесть Redux?

Context API и Redux — два популярных решения для управления состоянием в React. Каждый имеет свои преимущества и лучше подходит для определенных сценариев использования.

Context API - Встроенное решение React:

Context API позволяет передавать данные через дерево компонентов без необходимости передавать props на каждом уровне.

Основы Context API включают четыре шага:

Первый шаг - создание контекста с помощью createContext.

Второй шаг - создание Provider компонента, который оборачивает дочерние компоненты и предоставляет значение контекста.

Третий шаг - создание custom hook для безопасного использования контекста с проверкой, что контекст используется внутри Provider.

Четвертый шаг - использование контекста в компонентах через custom hook.

Сложное состояние с useReducer:

Для более сложного состояния можно использовать useReducer вместе с Context API. Это позволяет создать reducer для управления состоянием и action creators для выполнения операций.

Множественные контексты:

Можно разделить состояние на специализированные контексты: AuthContext для аутентификации, UIContext для интерфейса, DataContext для данных. Это позволяет избежать ненужных ререндеров.

Redux - Предсказуемое управление состоянием:

Redux предоставляет централизованное хранилище состояния с предсказуемыми обновлениями через actions и reducers.

Основы Redux включают actions - объекты описывающие изменения, action creators - функции создающие actions, reducers - чистые функции обновляющие состояние, и store - централизованное хранилище.

Redux Toolkit - современный подход:

Redux Toolkit упрощает работу с Redux через createSlice, который объединяет actions и reducer, createAsyncThunk для асинхронных операций, и configureStore для настройки store.

Сравнение Context API и Redux:

Context API хорошо подходит для простого состояния типа темы приложения, компонентно-специфичного состояния форм, и конфигурации приложения.

Redux хорошо подходит для сложного состояния с множественными обновлениями типа корзины товаров, состояния которое используется в множестве компонентов, и когда нужна история изменений и отладка.

Проблемы производительности:

Context API может вызывать проблему ререндеров, когда все consumers перерендериваются при изменении любого значения в контексте. Решения включают разделение контекстов и мемоизацию значений.

Redux использует селекторы для оптимизации, позволяя компонентам подписываться только на нужные части состояния.

Middleware и расширяемость:

Redux поддерживает middleware для логирования, асинхронных операций, и других расширений функциональности.

Тестирование:

Context API тестируется через создание mock provider компонентов.

Redux тестируется через создание тестового store и тестирование reducers отдельно от компонентов.

Практические рекомендации:

Гибридный подход позволяет использовать оба решения в одном приложении: Redux для глобального состояния и Context для локального состояния.

Миграция между решениями возможна постепенно, переводя части состояния из одного решения в другое.

Советы для senior разработчиков:

Используйте Context API для простого состояния, настроек UI, аутентификации. Используйте Redux для сложного состояния, кэширования данных, множественных обновлений. Комбинируйте решения - Context для локального, Redux для глобального состояния. Оптимизируйте производительность - разделяйте контексты, используйте селекторы в Redux. Тестируйте состояние отдельно от компонентов. Не переинжинирьте - начните с простого, усложняйте по необходимости. Redux Toolkit предпочтительнее классического Redux.

Связанные темы: Архитектура состояния приложения, Оптимизация ререндеров, useEffect и Side Effects, Higher-Order Components.
