# Безопасность Frontend Приложений (TTS)

Этот вопрос касается основных принципов и практик обеспечения безопасности фронтенд-приложений, включая защиту от различных типов атак и уязвимостей.

Основные Угрозы

OWASP Top 10 для Frontend включает injection атаки как XSS и SQL injection через фронтенд, broken authentication с небезопасной реализацией авторизации, sensitive data exposure или утечку данных во фронтенде.

Также важны XML External Entities через обработку XML, broken access control с неправильной авторизацией, security misconfiguration или неправильные настройки безопасности.

Cross-Site Scripting остается одной из главных угроз, как и insecure deserialization, использование компонентов с известными уязвимостями, недостаточное логирование и мониторинг.

XSS - Cross-Site Scripting

Типы XSS

Reflected XSS происходит когда пользовательский ввод отражается обратно в ответе без должной санитизации. Уязвимый код напрямую вставляет пользовательский ввод в innerHTML.

Безопасный подход использует DOMPurify для санитизации или создает DOM элементы через createElement и устанавливает textContent вместо innerHTML.

Stored XSS сохраняет вредоносный код в базе данных. В React важно избегать dangerouslySetInnerHTML без санитизации. React автоматически экранирует содержимое при обычном рендеринге.

DOM-based XSS происходит через манипуляции с DOM на клиенте. Опасно использовать innerHTML с данными из URL параметров или других ненадежных источников.

Защита от XSS

Content Security Policy блокирует выполнение inline скриптов и ограничивает источники ресурсов. Базовая CSP разрешает ресурсы только с того же домена.

Строгая CSP использует nonce для inline скриптов и strict-dynamic для динамически загружаемых скриптов.

Санитизация входных данных через DOMPurify удаляет или экранирует потенциально опасные элементы. Можно настроить разрешенные теги и атрибуты.

Экранирование для атрибутов заменяет специальные символы их HTML entities эквивалентами.

CSRF - Cross-Site Request Forgery

CSRF атаки заставляют пользователя выполнить нежелательные действия на сайте, где он аутентифицирован.

Защита включает CSRF токены, которые генерируются сервером и проверяются при каждом запросе. Токен должен отправляться в заголовке или форме.

SameSite cookies предотвращают отправку cookies в cross-site запросах. Strict полностью блокирует, Lax разрешает некоторые безопасные запросы.

Проверка Referer или Origin заголовков помогает убедиться, что запрос исходит с разрешенного домена.

Content Security Policy

CSP подробно настраивается для каждого типа ресурсов. default-src устанавливает правило по умолчанию, script-src для скриптов, style-src для стилей.

Для React приложений часто нужно разрешить unsafe-inline для styled-components и подключения к CDN для шрифтов.

Nonce для inline скриптов генерируется случайно для каждой загрузки страницы и позволяет выполнение только конкретных скриптов с правильным nonce.

Безопасность Аутентификации

JWT Security

Небезопасно хранить JWT в localStorage из-за доступности для JavaScript и XSS атак. Более безопасно использовать httpOnly cookies, устанавливаемые сервером.

Компромиссный подход - хранение access token в памяти с refresh token в httpOnly cookie. Access token имеет короткое время жизни.

Token validation на фронтенде включает базовые проверки истечения срока и issuer, но основная валидация должна происходить на сервере.

Session Management

Безопасное управление сессией отслеживает активность пользователя и автоматически завершает сессию при бездействии.

Важно очищать event listeners при завершении сессии и предупреждать пользователя о приближающемся истечении.

HTTPS и Transport Security

Strict Transport Security заставляет браузеры использовать только HTTPS соединения. HSTS заголовок включает время действия и применение к поддоменам.

Приложения должны автоматически перенаправлять на HTTPS, кроме localhost для разработки.

Certificate Pinning в прошлом использовался для привязки к конкретным сертификатам, сейчас заменен на Certificate Transparency и встроенную проверку браузерами.

Защита Данных

Шифрование на Frontend использует Web Crypto API для защиты чувствительных данных перед отправкой. RSA-OAEP подходит для асимметричного шифрования.

Хеширование паролей на клиенте добавляет дополнительную защиту, но основное хеширование должно происходить на сервере с солью.

Защита от утечек требует активной очистки чувствительных данных из памяти. Данные нужно перезаписывать перед удалением ссылок.

Автоматическая очистка при закрытии страницы через beforeunload event помогает предотвратить утечки.

Безопасность Dependencies

Аудит зависимостей через npm audit или yarn audit выявляет известные уязвимости. audit-ci автоматизирует проверки в CI/CD.

Защита от Supply Chain атак включает использование точных версий пакетов вместо диапазонов и настройку audit-level в npmrc.

Subresource Integrity для CDN ресурсов проверяет, что загруженные файлы соответствуют ожидаемому хешу и не были изменены.

Security Headers

Полный набор security заголовков включает Content Security Policy для контроля ресурсов, X-Frame-Options для защиты от clickjacking.

X-Content-Type-Options предотвращает MIME type sniffing, Referrer Policy контролирует передачу referrer информации.

Permissions Policy ограничивает доступ к browser APIs как геолокация, микрофон и камера.

React Helmet позволяет устанавливать security заголовки в Single Page Applications через meta теги.

Практические Рекомендации

Checklist для безопасности

Входные данные требуют валидации всех пользовательских данных, санитизации HTML контента, ограничения размера файлов и проверки типов.

Аутентификация должна использовать HTTPS, безопасное хранение токенов, logout на всех устройствах и ограничение попыток входа.

Авторизация включает проверку прав на фронтенде и бэкенде, скрытие чувствительных элементов интерфейса, валидацию на уровне API.

Конфигурация требует настройки CSP, установки security заголовков, удаления debug информации в production, минификации кода.

Безопасное кодирование

Обработка ошибок не должна выводить stack trace в production. Детали отправляются в системы мониторинга, пользователю показываются общие сообщения.

Работа с URL требует валидации параметров и использования URL API для безопасного создания ссылок.

Инструменты и Аудит

Статический анализ использует ESLint с правилами безопасности и SonarQube для анализа кода на уязвимости.

Динамическое тестирование включает тесты на XSS protection, проверку санитизации пользовательского ввода и экранирования HTML entities.

Browser Security Testing проверяет наличие и корректность CSP, обеспечивает использование HTTPS.

Мониторинг безопасности отслеживает нарушения CSP через securitypolicyviolation events и отправляет отчеты о нарушениях.

Автоматизация проверок в CI/CD включает аудит зависимостей, проверку CSP и других security заголовков.

Ключевые принципы безопасности

Defense in Depth обеспечивает многоуровневую защиту с несколькими линиями обороны.

Principle of Least Privilege предоставляет минимальные необходимые права доступа.

Input Validation проверяет все входные данные на корректность и безопасность.

Output Encoding кодирует выходные данные для предотвращения injection атак.

Security by Design встраивает безопасность с самого начала разработки, а не добавляет afterward.

Рекомендации для собеседования

На Senior-уровне ожидается глубокое понимание различных типов атак и способов защиты, знание современных security стандартов и best practices, опыт с настройкой CSP и security заголовков, понимание принципов безопасной аутентификации и авторизации, знание инструментов для аудита безопасности.

Частые вопросы на собеседованиях:
Как защитить приложение от XSS атак?
Что такое CSP и как его настроить?
Как безопасно хранить JWT токены?
Какие security заголовки нужно устанавливать?
Как проверить зависимости на уязвимости?

Практические задачи могут включать поиск и исправление XSS уязвимости в коде, настройку CSP для React приложения, реализацию безопасной аутентификации, проведение аудита безопасности.

Этот материал связан с темами Event Loop, Context API, управления состоянием и продвинутых типов TypeScript.
